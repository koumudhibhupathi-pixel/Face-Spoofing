<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Face Anti-Spoofing System</title>

<style>
body {
    font-family: Arial, sans-serif;
    background: linear-gradient(135deg, #667eea, #764ba2);
    margin: 0;
    padding: 20px;
    color: white;
}

.container {
    max-width: 1200px;
    margin: auto;
}

h1 {
    text-align: center;
    margin-bottom: 30px;
}

.main {
    display: grid;
    grid-template-columns: 2fr 1fr;
    gap: 20px;
}

.card {
    background: white;
    color: black;
    padding: 20px;
    border-radius: 12px;
    box-shadow: 0 10px 25px rgba(0,0,0,0.3);
}

video {
    width: 100%;
    border-radius: 10px;
}

.status-box {
    margin-bottom: 20px;
}

.status-value {
    font-size: 1.8em;
    font-weight: bold;
}

.real {
    color: green;
}

.spoof {
    color: red;
}

.waiting {
    color: orange;
}

.stat {
    margin-top: 10px;
    font-size: 1.1em;
}

button {
    padding: 10px 20px;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    margin-top: 10px;
    font-weight: bold;
}

.reset-btn {
    background: crimson;
    color: white;
}

@media(max-width:768px){
    .main {
        grid-template-columns: 1fr;
    }
}
</style>
</head>

<body>

<div class="container">
    <h1>üîí Face Anti-Spoofing System</h1>

    <div class="main">

        <!-- CAMERA SECTION -->
        <div class="card">
            <h2>üìπ Live Camera</h2>
            <video id="video" autoplay playsinline></video>
            <canvas id="canvas" style="display:none;"></canvas>
        </div>

        <!-- STATUS PANEL -->
        <div class="card">
            <h2>üìä Detection Status</h2>

            <div class="status-box">
                <div>Status:</div>
                <div id="status-display" class="status-value waiting">
                    WAITING
                </div>
            </div>

            <div class="stat">üëÅ Total Blinks: <span id="total-blinks">0</span></div>
            <div class="stat">‚è± Recent Blinks: <span id="recent-blinks">0</span></div>
            <div class="stat">‚úÖ Real Count: <span id="real-count">0</span></div>
            <div class="stat">üö® Spoof Count: <span id="spoof-count">0</span></div>
            <div class="stat">‚è≥ Session: <span id="session-time">0</span>s</div>

            <button class="reset-btn" onclick="resetSystem()">Reset</button>
        </div>

    </div>
</div>

<script>
const video = document.getElementById('video');
const canvas = document.getElementById('canvas');
const statusDisplay = document.getElementById('status-display');

// Access browser camera
navigator.mediaDevices.getUserMedia({ video: true })
.then(stream => {
    video.srcObject = stream;
})
.catch(err => {
    alert("Camera access denied!");
});

// Send frame every 1 second
setInterval(() => {

    if (!video.videoWidth) return;

    const context = canvas.getContext('2d');
    canvas.width = video.videoWidth;
    canvas.height = video.videoHeight;
    context.drawImage(video, 0, 0);

    const imageData = canvas.toDataURL('image/jpeg');

    fetch('/process_frame', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ image: imageData })
    })
    .then(response => response.json())
    .then(data => {

        statusDisplay.innerText = data.status;

        if (data.status === "REAL PERSON") {
            statusDisplay.className = "status-value real";
        } else if (data.status === "SPOOF DETECTED") {
            statusDisplay.className = "status-value spoof";
        } else {
            statusDisplay.className = "status-value waiting";
        }

        document.getElementById('total-blinks').innerText = data.total_blinks;
        document.getElementById('recent-blinks').innerText = data.recent_blinks;

        updateStats();

    });

}, 1000);


// Update additional stats
function updateStats() {
    fetch('/stats')
    .then(response => response.json())
    .then(data => {
        document.getElementById('real-count').innerText = data.real_count;
        document.getElementById('spoof-count').innerText = data.spoof_count;
        document.getElementById('session-time').innerText = data.session_duration;
    });
}


// Reset
function resetSystem() {
    fetch('/reset')
    .then(response => response.json())
    .then(data => {
        alert(data.message);
    });
}
</script>

</body>
</html>
